name: "~Sandbox"

on:
  workflow_dispatch:
  # push:

permissions:
  contents: write  # to fetch code
  actions:  write # to cancel previous workflows
  packages: write # to upload container

jobs:

  bump-world-state:
    runs-on: ubuntu-22.04
    steps:
      - name: Check out the repository under ${GITHUB_WORKSPACE}
        uses: actions/checkout@v3
      - name: Update manifest and patches
        working-directory: .github/container
        shell: bash -x -e {0}
        run: |
          bash bump.sh manifest.yaml
      - name: Commit trial branch
        shell: bash -x -e {0}
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          trial_branch=nightly-${{ github.run_id }}
          git switch -c $trial_branch
          git status
          git add -u
          git add .github/container/patches/
          git status
          git commit -m "generated ${{github.run_id }}"
          git push --set-upstream origin $trial_branch
