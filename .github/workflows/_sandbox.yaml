name: "~Sandbox"

on:
  push:

jobs:
  set-json:
    runs-on: ubuntu-22.04
    outputs:
      ALL_TAGS: ${{ steps.setjson.outputs.ALL_TAGS }}
    steps:
      - name: Set JSON object
        id: setjson
        shell: bash -x -e {0}
        run: |
          A=$(cat << EOF
            { \
            "TAG_JAX_MEALKIT": "TAG_JAX_MEALKIT_VALUE", \
            "TAG_JAX_FINAL": "TAG_JAX_FINAL_VALUE", \
            "TAG_UPSTREAM_T5X_MEALKIT": "TAG_UPSTREAM_T5X_MEALKIT_VALUE", \
            "TAG_UPSTREAM_T5X_FINAL": "TAG_UPSTREAM_T5X_FINAL" \
            }
          EOF
          )
          echo "ALL_TAGS=${A}" >> $GITHUB_OUTPUT
  
  get-json:
    runs-on: ubuntu-22.04
    needs: set-json
    strategy:
      matrix:
        include:
          - TAG: JAX
            CONTAINER_IMAGE: MEALKIT
          - TAG: UPSTREAM_T5X
            CONTAINER_IMAGE: FINAL
    steps:
      - name: echo values
        run: |
          echo ALL_TAGS=${{ fromJson(needs.set-json.outputs.ALL_TAGS) }}
          echo FORMAT=${{ format('TAG_{0}_MEALKIT', matrix.TAG) }}
          echo MEALKIT=${{ fromJson(needs.set-json.outputs.ALL_TAGS).TAG_format('{0}_MEALKIT', matrix.TAG) }}
          echo FINAL=${{ fromJson(needs.set-json.outputs.ALL_TAGS).TAG_format('{0}_FINAL', matrix.TAG) }}
          echo $TAG_A
          




