name: "~Sandbox"

on:
  workflow_dispatch:

jobs:
  launch-slurm-runner:
    runs-on: ubuntu-latest
    env:
      OCI_CLI_USER: ${{ secrets.OCI_CLI_USER }}
      OCI_CLI_TENANCY: ${{ secrets.OCI_CLI_TENANCY }}
      OCI_CLI_FINGERPRINT: ${{ secrets.OCI_CLI_FINGERPRINT }}
      OCI_CLI_KEY_CONTENT: ${{ secrets.OCI_CLI_KEY_CONTENT }}
      OCI_CLI_REGION: ${{ secrets.OCI_CLI_REGION }}

    steps:
      - name: Print environment variables
        run: env

      - name: Check out the repository under ${GITHUB_WORKSPACE}
        uses: actions/checkout@v4

      - name: Get IP Addresses
        id: ip
        run: |
          IP_ADRESS=$(curl api.ipify.org)
          echo "RUNNER_IP_ADDRESS=${IP_ADRESS}" >> $GITHUB_OUTPUT

      - name: See IP Address
        run: |
          echo ${{ steps.ip.outputs.RUNNER_IP_ADDRESS }}

      - name: Retrieve the OCID of a named compartment in tenancy
        uses: oracle-actions/run-oci-cli-command@v1.3.0
        id: find-compartment-id
        with:
          command: 'iam compartment list --compartment-id-in-subtree=true'
          query: "data[?name=='testing'].id"
      # - name: Setup SSH agent
      #   uses: webfactory/ssh-agent@v0.9.0
      #   with:
      #     ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      # - name: Setup SSH known hosts
      #   id: ssh-known-hosts
      #   run: |
      #     mkdir -p ~/.ssh
      #     cat >> ~/.ssh/known_hosts << EOF
      #     ${{ vars.SSH_KNOWN_HOSTS }}
      #     EOF
      #     chmod 600 ~/.ssh/known_hosts
      #     echo "FILE=$(realpath ~/.ssh/known_hosts)" >> $GITHUB_OUTPUT

      # - name: Submit SLURM jobs over SSH
      #   id: submit
      #   shell: bash -x -e {0}
      #   run: |
      #     ssh -o "ServerAliveInterval 7" ${{ secrets.CLUSTER_LOGIN_USER }}@${{ vars.HOSTNAME_SLURM_LOGIN }} "date && hostname && sinfo"

