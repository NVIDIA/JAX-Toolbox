name: "~Sandbox"

on:
  workflow_dispatch:
  push:
    branches:
      - unify-output

permissions:
  contents: read  # to fetch code
  actions:  write # to cancel previous workflows
  packages: write # to upload container

jobs:

  run-jobs:
    uses: ./.github/workflows/_test_jax.yaml
    with:
      JAX_IMAGE: 'ghcr.io/nvidia/jax:latest'
    secrets: inherit

  upload-badge:
    needs: [run-jobs]
    uses: ./.github/workflows/_upload_badge.yaml
    secrets: inherit

  report:
    needs: [run-jobs]
    uses: ./.github/workflows/_summary.yaml
    secrets: inherit

  publish-badge:
    needs: [upload-badge]
    uses: ./.github/workflows/_copy_gist.yaml
    with:
      SRC_GIST_ID: ${{ needs.upload-badge.outputs.GIST_ID }}
      DST_GIST_ID: '2a125e4324bcc45f581bece2620e1b30'
      FILES: '.*badge.*.json'
    secrets: inherit
