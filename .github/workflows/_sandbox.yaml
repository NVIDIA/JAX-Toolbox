name: "~Sandbox"

on:
  # workflow_dispatch:
  push:

permissions:
  contents: read  # to fetch code
  actions:  write # to cancel previous workflows
  packages: write # to upload container

jobs:

  # build-jax:
  #   uses: ./.github/workflows/_build_jax.yaml
  #   with:
  #     ARCHITECTURE: amd64
  #   secrets: inherit

  build-pax:
    # needs: [build-jax]
    uses: ./.github/workflows/_build_pax.yaml
    with:
      ARCHITECTURE: amd64
      # BASE_IMAGE: ${{ needs.build-jax.outputs.DOCKER_TAG_MEALKIT }}
    secrets: inherit

  test-pax:
    needs: [build-pax]
    uses: ./.github/workflows/_test_pax.yaml
    with:
      PAX_IMAGE: ${{ needs.build-pax.outputs.DOCKER_TAG_FINAL }}

  # finalize:
  #   if: always()
  #   # TODO: use dynamic matrix to make dependencies self-updating
  #   needs: [build-jax, build-t5x, build-pax]
  #   uses: ./.github/workflows/_finalize.yaml
  #   with:
  #     PUBLISH_BADGE: false
  #   secrets: inherit
