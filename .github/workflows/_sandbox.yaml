name: "~Sandbox"

on:
  workflow_dispatch:
  push:

permissions:
  contents: read  # to fetch code
  actions:  write # to cancel previous workflows
  packages: write # to upload container

jobs:

  # build-base:
  #   uses: ./.github/workflows/_build_base.yaml
  #   with:
  #     ARCHITECTURE: amd64
  #   secrets: inherit

  # build-jax:
  #   needs: [build-base]
  #   uses: ./.github/workflows/_build_jax.yaml
  #   with:
  #     ARCHITECTURE: amd64
  #     BASE_IMAGE: ${{ needs.build-base.outputs.DOCKER_TAG }}
  #   secrets: inherit

  # build-pax:
  #   needs: [build-jax]
  #   uses: ./.github/workflows/_build_pax.yaml
  #   with:
  #     ARCHITECTURE: amd64
  #     BASE_IMAGE: ${{ needs.build-jax.outputs.DOCKER_TAG_MEALKIT }}
  #   secrets: inherit

  # build-t5x:
  #   needs: [build-jax]
  #   uses: ./.github/workflows/_build_t5x.yaml
  #   with:
  #     ARCHITECTURE: amd64
  #     BASE_IMAGE: ${{ needs.build-jax.outputs.DOCKER_TAG_MEALKIT }}
  #   secrets: inherit

  # test-pax:
  #   needs: [build-pax]
  #   uses: ./.github/workflows/_test_pax.yaml
  #   with:
  #     PAX_IMAGE: ${{ needs.build-pax.outputs.DOCKER_TAG_FINAL }}
  #   secrets: inherit


  # test-te:
  #   needs: [build-pax]
  #   uses: ./.github/workflows/_test_te.yaml
  #   with:
  #     TE_IMAGE: ${{ needs.build-pax.outputs.DOCKER_TAG_FINAL }}
  #   secrets: inherit

  build-rosetta-pax:
    uses: ./.github/workflows/_build_rosetta.yaml
    # needs: [metadata, build-pax]
    with:
      ARCHITECTURE: amd64
      BUILD_DATE: "2023-11-15"
      BASE_IMAGE: ghcr.io/nvidia/jax-toolbox-internal:6896408819-upstream-pax-amd64
      BASE_LIBRARY: pax
    secrets: inherit
